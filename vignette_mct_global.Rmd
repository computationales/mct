---
title: "Determine plant-WHC globally"
author: "Beni Stocker"
date: "4/30/2019"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
library(dplyr)
library(rbeni)
library(tidyr)
library(purrr)
library(ncdf4)
library(lubridate)
library(extRemes)
library(R.utils)

source("R/mct.R")
source("R/get_plantwhc_mct_bysite.R")
source("R/get_plantwhc_mct_global.R")
```

Invoke all at once.
```{r}
dir <- "~/sofun/output_nc_global_sofun/"
gridfile <- "./data/df_grid.Rdata"
if (file.exists(gridfile)){
  load(gridfile)
} else {
  df_grid <- get_df_landmask(dir)
  save(df_grid, file = gridfile)
}
df <- get_plantwhc_mct_global(df_grid, dir)

# %>% 
#   unnest(out_ilon_ilat)

## test
#test <- get_plantwhc_mct_gridcell(211, 75, dir)
```